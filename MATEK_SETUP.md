# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Matek F405

## üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### –§–∏–∑–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

Matek F405 –∏–º–µ–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ UART –ø–æ—Ä—Ç–æ–≤:

- **UART1** - –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è GPS/—Ä–∞–¥–∏–æ–º–æ–¥—É–ª—è
- **UART2** - —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **UART3** - —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç
- **UART4** - —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç

**–°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
```
–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å (Raspberry Pi / Jetson Nano)
    TX (GPIO 14) ‚îÄ‚îÄ> UART2 RX (Matek F405)
    RX (GPIO 15) ‚îÄ‚îÄ> UART2 TX (Matek F405)
    GND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> GND
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä—Ç–∞ –Ω–∞ Raspberry Pi

1. **–í–∫–ª—é—á–∏—Ç—å UART:**
   ```bash
   sudo raspi-config
   # Interface Options ‚Üí Serial Port ‚Üí Enable
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ—Ä—Ç—ã:**
   ```bash
   ls -l /dev/tty*
   # –û–±—ã—á–Ω–æ —ç—Ç–æ /dev/ttyAMA0 –∏–ª–∏ /dev/ttyS0
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
   ```bash
   sudo minicom -D /dev/ttyAMA0 -b 57600
   ```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ArduPilot

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

–í ArduPilot –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∏–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:

```bash
# –í–∫–ª—é—á–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é
VISODOM_ENABLE = 1          # –í–∫–ª—é—á–∏—Ç—å Visual Odometry
VISODOM_TYPE = 2            # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VISION_POSITION_ESTIMATE

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
EK3_SRC1_POSXY = 6         # Visual Odometry –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ X/Y
EK3_SRC1_VELXY = 6         # Visual Odometry –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ X/Y
EK3_SRC1_POSZ = 1          # Barometer –¥–ª—è –≤—ã—Å–æ—Ç—ã (–∏–ª–∏ GPS –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)

# –î–æ–≤–µ—Ä–∏–µ –∫ –≤–∏–∑—É–∞–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
VISODOM_POS_LAG = 0.1      # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ (—Å–µ–∫—É–Ω–¥—ã)
VISODOM_XY_P = 0.01        # –¢–æ—á–Ω–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏ X/Y
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞

–í Mission Planner –∏–ª–∏ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```
SERIAL2_PROTOCOL = 2       # MAVLink 2
SERIAL2_BAUD = 57600       # –°–∫–æ—Ä–æ—Å—Ç—å (–∏–ª–∏ 115200)
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
python matek_integration.py
```

**–í–∞–∂–Ω–æ:** –£–∫–∞–∂–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ä—Ç –≤ –∫–æ–¥–µ:
```python
bridge = MatekF405Bridge(
    navigation_system=nav_system,
    serial_port='/dev/ttyAMA0',  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –ø–æ—Ä—Ç!
    baudrate=57600
)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞

–ù–∞–π–¥–∏—Ç–µ –ø–æ—Ä—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å –≤—Å–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã
ls -l /dev/tty* | grep -E "(USB|AMA|S0)"

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å dmesg –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
dmesg | grep tty

# –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Python
python3 -c "import serial.tools.list_ports; [print(p.device) for p in serial.tools.list_ports.comports()]"
```

## üì° –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏

–°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Matek F405:

1. **VISION_POSITION_ESTIMATE** - –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –ü–æ–∑–∏—Ü–∏—è –≤ –º–µ—Ç—Ä–∞—Ö (NED: North, East, Down)
   - –ö–æ–≤–∞—Ä–∏–∞—Ü–∏—è (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å)
   - –ß–∞—Å—Ç–æ—Ç–∞: 10 –ì—Ü

2. **LOCAL_POSITION_NED** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –ü–æ–∑–∏—Ü–∏—è –∏ —Å–∫–æ—Ä–æ—Å—Ç—å
   - –ß–∞—Å—Ç–æ—Ç–∞: 10 –ì—Ü

### –§–æ—Ä–º–∞—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **NED** (North-East-Down):
- **North (X)**: + = –Ω–∞ —Å–µ–≤–µ—Ä, - = –Ω–∞ —é–≥
- **East (Y)**: + = –Ω–∞ –≤–æ—Å—Ç–æ–∫, - = –Ω–∞ –∑–∞–ø–∞–¥  
- **Down (Z)**: + = –≤–Ω–∏–∑ (–≤—ã—Å–æ—Ç–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è), - = –≤–≤–µ—Ä—Ö

–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑ –ø–∏–∫—Å–µ–ª–µ–π –∫–∞–º–µ—Ä—ã:
- –û—Å—å Y –∫–∞–º–µ—Ä—ã ‚Üí North (–∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ)
- –û—Å—å X –∫–∞–º–µ—Ä—ã ‚Üí East

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Å—à—Ç–∞–±–∞

–ú–∞—Å—à—Ç–∞–± –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã—Å–æ—Ç—ã –ø–æ–ª–µ—Ç–∞:

```python
# –í—ã—Å–æ—Ç–∞ 50–º: ~20 –ø–∏–∫—Å–µ–ª–µ–π = 1 –º–µ—Ç—Ä
pixels_to_meters = 1.0 / 20.0

# –í—ã—Å–æ—Ç–∞ 200–º: ~5 –ø–∏–∫—Å–µ–ª–µ–π = 1 –º–µ—Ç—Ä
pixels_to_meters = 1.0 / 5.0

# –í—ã—Å–æ—Ç–∞ 800–º: ~1 –ø–∏–∫—Å–µ–ª—å = 1 –º–µ—Ç—Ä
pixels_to_meters = 1.0 / 1.0
```

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –∫–æ–¥–µ:
```python
bridge = MatekF405Bridge(
    navigation_system=nav_system,
    serial_port='/dev/ttyAMA0',
    pixels_to_meters=0.05  # 20 –ø–∏–∫—Å–µ–ª–µ–π = 1 –º–µ—Ç—Ä
)
```

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç —Å–≤—è–∑–∏ —Å Matek F405

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏ (57600 –∏–ª–∏ 115200)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ—Ä—Ç—É:
   ```bash
   sudo usermod -a -G dialout $USER
   sudo chmod 666 /dev/ttyAMA0
   ```
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç –Ω–µ –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º

### –ü—Ä–æ–±–ª–µ–º–∞: ArduPilot –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã VISODOM –≤ ArduPilot
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ MAVLink –≤–∫–ª—é—á–µ–Ω –Ω–∞ –Ω—É–∂–Ω–æ–º UART
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ ArduPilot —á–µ—Ä–µ–∑ Mission Planner

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∞—Å—à—Ç–∞–± `pixels_to_meters`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é –æ—Å–µ–π (–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∏–Ω–≤–µ—Ä—Å–∏—è)
3. –ö–∞–ª–∏–±—Ä—É–π—Ç–µ –ø—Ä–∏ –≤–∑–ª–µ—Ç–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

## üìù –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

```python
from drone_navigation import DroneNavigationSystem
from matek_integration import MatekF405Bridge

# 1. –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
nav_system = DroneNavigationSystem(
    camera_id=0,
    target_fps=10.0
)

# 2. –°–æ–∑–¥–∞—Ç—å –º–æ—Å—Ç —Å Matek F405
bridge = MatekF405Bridge(
    navigation_system=nav_system,
    serial_port='/dev/ttyAMA0',
    baudrate=57600,
    pixels_to_meters=0.05  # –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥ –≤—ã—Å–æ—Ç—É
)

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
nav_system.start()

# 4. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫ Matek F405
if bridge.start():
    # –°–∏–≥–Ω–∞–ª –≤–∑–ª–µ—Ç–∞ (–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–∞–ª–∏–±—Ä–æ–≤–∫—É)
    nav_system.takeoff()
    
    # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
    import time
    while True:
        bridge.update()  # –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Matek F405
        time.sleep(0.1)
```

## üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [ArduPilot Visual Odometry](https://ardupilot.org/copter/docs/common-visual-odometry-landing-page.html)
- [MAVLink Protocol](https://mavlink.io/en/)
- [Matek F405 Documentation](https://www.mateksys.com/?portfolio=f405-wing)

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

- [ ] –§–∏–∑–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ TX/RX/GND
- [ ] UART –≤–∫–ª—é—á–µ–Ω –Ω–∞ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª–µ
- [ ] –ü–æ—Ä—Ç –Ω–∞–π–¥–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] MAVLink –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ ArduPilot
- [ ] VISODOM –≤–∫–ª—é—á–µ–Ω –≤ ArduPilot
- [ ] –°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç (57600/115200)
- [ ] –ú–∞—Å—à—Ç–∞–± –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–æ–¥ –≤—ã—Å–æ—Ç—É –ø–æ–ª–µ—Ç–∞
- [ ] –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –≤–∑–ª–µ—Ç–µ

